
## 字符串--SDS(Simple Dynamic String)

Redis使用的字符串其实是基于C语言的字符串，字符串以'\0'结尾。

### 空间预分配

1.如果对于SDS修改之后,SDS的长度小于1MB,那么预分配的free空间长度=已使用的buf空间长度

2.如果对于SDS修改之后，SDS的长度大于1MB，那么会预分配1MB的free空间

通过预分配冗余空间的方式，减少字符串修改、拼接带来的空间重分配的性能影响。

### 惰性空间释放

未使用的空间不会立即被释放，而是会将空间长度存储在free属性中，等待未来使用。

## 链表

双端、无环、带表头指针和表尾指针、带链表长度计数器、多态

## 跳跃表

跳跃表(skiplist)是一种有序的数据结构，他通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的。

节点查找复杂度平均O(logN)，最坏O(N)。大多数情况下，跳表的效率可以跟平衡树相媲美，并且因为跳表的实现要比平衡树简单，所以很多程序都使用跳表来替代平衡树。

Redis只在两个地方用到了跳跃表，一个是实现有序集合键，另外一个是在集群节点中用作内部数据结构，除此之外，跳跃表在Redis中没有其他用途。

### zskiplist和zskiplistNode

#### zskiplistNode

1.层：层用来存储前进指针和跨度。节点层的数量越多，访问其他节点的速度就越快，但消耗的内存空间也就更大。每次创建一个新的跳跃表节点的时候，程序都会根据幂次定律随机生成一个介于1和32之间的值作为level数组的大小，这个大小就是层的高度。

2.前进指针： 指向表尾方向，用于从表头向表尾方向访问节点。

3.跨度： 用于记录两个节点之间的距离。 两个节点之间的跨度越大，他们相距的就越远。指向NULL的所有前进指针的跨度都为0.

4.后退指针：反向遍历跳跃表

5.分值和成员： 跳跃表中所有节点按照分值从小到大排序， 成员对象是一个指针，指向一个字符串对象，字符串对象保存着一个SDS值。

#### zskiplist

zskiplist结构用来持有zskiplistNode,方便对于整个跳跃表进行处理，比如快速访问跳跃表的表头节点和表尾节点，或者快速地获取跳跃表节点的数量等信息。

